
## FORMAT SELECTION

デフォルトでは、yt-dlpはオプションを指定しない場合、最良の品質をダウンロードしようとします。<br>
これは一般的に `-f bestvideo*+bestaudio/best` を使用するのと同じです。<br>
ただし、複数のオーディオストリームが有効になっている場合（`--audio-multistreams`）、デフォルトの形式は `-f bestvideo+bestaudio/best` に変更されます。<br>
同様に、ffmpegが利用できない場合や、yt-dlpを使用して標準出力（`-o -`）にストリームする場合、デフォルトは `-f best/bestvideo+bestaudio` になります。

**非推奨警告**: yt-dlpの最新バージョンでは、ffmpegを使用して複数のフォーマットを同時に標準出力にストリームできます。<br>
そのため、将来的なバージョンでは、これに対するデフォルトが `-f bv*+ba/b` に設定される予定です。<br>
`-f b/bv+ba` 設定を保持したい場合は、設定オプションで明示的に指定することをお勧めします。

フォーマット選択の一般的な構文は `-f FORMAT`（または `--format FORMAT`）で、`FORMAT` はフォーマットまたはダウンロードしたいフォーマットを記述する選択子表現です。


最も簡単なケースは、特定のフォーマットを要求することです。<br>
例えば、`-f 22` を使用すると、フォーマットコードが22のフォーマットをダウンロードできます。<br>
特定のビデオの利用可能なフォーマットコードのリストは、`--list-formats` または `-F` を使用して取得できます。<br>
これらのフォーマットコードは、抽出器ごとに異なります。

また、ファイル拡張子（現在サポートされているのは `3gp`, `aac`, `flv`, `m4a`, `mp3`, `mp4`, `ogg`, `wav`, `webm`）を使用して、特定のファイル拡張子で提供される最良の品質のフォーマットをダウンロードすることもできます。<br>
例えば、`-f webm` を使用すると、webm 拡張子を持つ最良の品質のフォーマットをダウンロードできます。

`-f -` を使用すると、各ビデオに対してインタラクティブにフォーマットセレクタを提供できます。


特定のエッジケースのフォーマットを選択するために、特別な名前を使用することもできます：

- `all`:<br>
    すべてのフォーマットを個別に選択

- `mergeall`:<br>
    すべてのフォーマットを選択し、マージする（`--audio-multistreams`、`--video-multistreams`、またはその両方と共に使用する必要があります）

- `b*`, `best*`:<br>
    ビデオまたはオーディオ、またはその両方を含む最良の品質のフォーマットを選択<br>
    （つまり、`vcodec!=none` または `acodec!=none`）

- `b`, `best`:<br>
    ビデオとオーディオの両方を含む最良の品質のフォーマットを選択。<br>
    `best*[vcodec!=none][acodec!=none]` と同等

- `bv`, `bestvideo`:<br>
    最良の品質のビデオ専用フォーマットを選択。<br>
    `best*[acodec=none]` と同等

- `bv*`, `bestvideo*`:<br>
    ビデオを含む最良の品質のフォーマットを選択。<br>
    オーディオも含まれる場合があります。`best*[vcodec!=none]` と同等

- `ba`, `bestaudio`:<br>
    最良の品質のオーディオ専用フォーマットを選択。`best*[vcodec=none]` と同等

- `ba*`, `bestaudio*`:<br>
    オーディオを含む最良の品質のフォーマットを選択。<br>
    ビデオも含まれる場合があります。`best*[acodec!=none]`（使用しないことを推奨）

- `w`, `worst`:<br>
    ビデオまたはオーディオ、またはその両方を含む最悪の品質のフォーマットを選択

- `w*`, `worst*`:<br>
    ビデオとオーディオの両方を含む最悪の品質のフォーマットを選択。<br>
    `worst*[vcodec!=none][acodec!=none]` と同等

- `wv`, **worstvideo**: 最悪の品質のビデオ専用フォーマットを選択。<br>
    `worst*[acodec=none]` と同等

- `wv*`, `worstvideo*`:<br>
    ビデオを含む最悪の品質のフォーマットを選択。<br>
    オーディオも含まれる場合があります。<br>
    `worst*[vcodec!=none]` と同等

- `wa`, `worstaudio`:<br>
    最悪の品質のオーディオ専用フォーマットを選択。`worst*[vcodec=none]` と同等

- `wa*`, `worstaudio*`:<br>
    オーディオを含む最悪の品質のフォーマットを選択。<br>
    ビデオも含まれる場合があります。`worst*[acodec!=none]`

<br>

例えば、最悪の品質のビデオ専用フォーマットをダウンロードするには、`-f worstvideo` を使用できます。<br>
ただし、`worst` とそれに関連するオプションは使用しないことをお勧めします。<br>
フォーマットセレクタが `worst` の場合、すべての面で最も劣ったフォーマットが選択されます。<br>
ほとんどの場合、実際に必要なのは最小のファイルサイズのビデオです。<br>
したがって、`-f worst` を使用する代わりに、`-S +size` や、より厳密には `-S +size,+br,+res,+fps` を使用する方が一般的に良いです。<br>
詳細については「フォーマットのソート」を参照してください。

指定されたタイプの n 番目に良いフォーマットを選択するには、`best<type>.<n>` を使用します。<br>
例えば、`best.2` は 2 番目に良い組み合わせのフォーマットを選択します。<br>
同様に、`bv*.3` は 3 番目に良いビデオストリームを含むフォーマットを選択します。

複数のビデオをダウンロードしたい場合で、それらが同じフォーマットを持っていない場合、スラッシュを使って優先順位を指定できます。<br>
左側のフォーマットが優先されます。<br>
例えば、`-f 22/17/18` は、フォーマット 22 が利用可能であればそれをダウンロードし、次にフォーマット 17 が利用可能であればそれをダウンロードし、それも利用できない場合はフォーマット 18 をダウンロードします。<br>
すべてが利用できない場合は、適切なフォーマットが見つからないと警告します。

同じビデオの複数のフォーマットをダウンロードしたい場合は、カンマで区切ります。<br>
例えば、`-f 22,17,18` は、これら 3 つのフォーマットをすべてダウンロードします（もちろん、利用可能な場合）。<br>
また、優先順位機能を組み合わせたより高度な例：`-f 136/137/mp4/bestvideo,140/m4a/bestaudio`

複数のフォーマットのビデオとオーディオを 1 つのファイルにマージするには、`-f <format1>+<format2>+...` を使用します（ffmpeg がインストールされている必要があります）。<br>
例えば、`-f bestvideo+bestaudio` は、最良のビデオ専用フォーマットと最良のオーディオ専用フォーマットをダウンロードし、それらを ffmpeg でマージします。

**非推奨警告**: 以下で説明する動作は複雑で直感的でないため、将来的にはこれが削除され、マルチストリームがデフォルトで有効になります。<br>
その代わり、単一のオーディオ/ビデオフォーマットに制限する新しい演算子が追加される予定です。

`--video-multistreams` が使用されていない限り、最初のビデオストリームを除いてすべてのビデオストリームは無視されます。<br>
同様に、`--audio-multistreams` が使用されていない限り、最初のオーディオストリームを除いてすべてのオーディオストリームは無視されます。<br>
例えば、`-f bestvideo+best+bestaudio --video-multistreams --audio-multistreams` は、3 つの指定されたフォーマットをダウンロードしてマージします。<br>
結果のファイルには 2 つのビデオストリームと 2 つのオーディオストリームが含まれます。<br>
しかし、`-f bestvideo+best+bestaudio --no-video-multistreams` は、`bestvideo` と `bestaudio` のみをダウンロードしてマージし、`best` は無視されます。<br>
すでにビデオストリームを含むフォーマット（`bestvideo`）が選択されているためです。<br>
フォーマットの順序は重要です。<br>
`-f best+bestaudio --no-audio-multistreams` は `best` のみをダウンロードし、`-f bestaudio+best --no-audio-multistreams` は `best` を無視して `bestaudio` のみをダウンロードします。


## Filtering Formats

### **フィルタを使った動画フォーマットの指定方法**

動画フォーマットは、`-f` `"best[height=720]"` のように条件を括弧で指定することでフィルタリングできます（または `-f` `"[filesize>10M]"` のように、セレクタなしのフィルタは最良のものと解釈されます）。

以下の数値メタフィールドは、比較演算子 `<`, `<=`, `>`, `>=`, `=` (等しい), `!=` (等しくない) を使って指定できます：

- `filesize`: 事前にわかっている場合のバイト数<br>
- `filesize_approx`: バイト数の概算値<br>
- `width`: 動画の幅（わかっている場合）<br>
- `height`: 動画の高さ（わかっている場合）<br>
- `aspect_ratio`: 動画のアスペクト比（わかっている場合）<br>
- `tbr`: 音声と動画の平均ビットレート（kbps単位）<br>
- `abr`: 音声の平均ビットレート（kbps単位）<br>
- `vbr`: 動画の平均ビットレート（kbps単位）<br>
- `asr`: 音声のサンプリングレート（Hz単位）<br>
- `fps`: フレームレート<br>
- `audio_channels`: 音声チャンネルの数<br>
- `stretched_ratio`: 動画のピクセルの幅:高さ（正方形でない場合）<br>


### **比較によるフィルタリング**

フィルタリングは、比較演算子（`=` (等しい)、`^=` (開始)、`$=` (終了)、`*=` (含む)、`~=` (正規表現に一致)）にも対応しています。<br>
さらに、次の文字列メタフィールドでもフィルタリングが可能です：

- `url`: ビデオURL
- `ext`: ファイル拡張子
- `acodec`: 使用中の音声コーデック名
- `vcodec`: 使用中のビデオコーデック名
- `container`: コンテナ形式の名前
- `protocol`: 実際のダウンロードに使用されるプロトコル（小文字で記述、http, https, rtsp, rtmp, rtmpe, mms, f4m, ism, http_dash_segments, m3u8, または m3u8_native）
- `language`: 言語コード
- `dynamic_range`: ビデオのダイナミックレンジ
- `format_id`: フォーマットの簡単な説明
- `format`: フォーマットの人間が読める説明
- `format_note`: フォーマットに関する追加情報
- `resolution`: 幅と高さのテキストによる説明


### **文字列比較における否定**

任意の文字列比較は、否定 `!` を前置することで逆の比較を行うことができます。<br>
例えば、`!*=` (含まない) のように使用します。<br>
文字列比較の比較対象は、スペースや特殊文字（`. _ -` 以外）が含まれる場合、ダブルクォートまたはシングルクォートで囲む必要があります。

注意: 前述のメタフィールドは、特定の抽出ツールによって得られるメタデータに依存するため、必ずしも存在するわけではありません。<br>
すなわち、ウェブサイトが提供するメタデータに依存します。<br>
また、抽出ツールによって提供される他のフィールドもフィルタリングに使用することができます。<br>

### **不明な値を持つフォーマットの除外**

値が不明なフォーマットは、演算子の後に `?` を付けない限り除外されます。<br>
例えば、`-f` `"bv[height<=?720][tbr>500]"` は、720p以下（または高さが不明）のビデオで、ビットレートが500 kbps以上のものを選択します。

また、フィルタを「`all`」と組み合わせて、フィルタを満たすすべてのフォーマットをダウンロードすることもできます。<br>
例：`-f` `"all[vcodec=none]"` は、すべての音声のみのフォーマットを選択します。<br>

フォーマットセレクターのグループ化

フォーマットセレクターは括弧を使ってグループ化することもできます。<br>
例えば、`-f` `"(mp4,webm)[height<480]"` は、480未満の高さの最適なプレマージされたmp4およびwebmフォーマットをダウンロードします。